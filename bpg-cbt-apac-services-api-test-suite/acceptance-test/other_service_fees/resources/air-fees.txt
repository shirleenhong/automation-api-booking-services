*** Settings ***
Resource    ../../resources/api-imports.txt
Resource    ../../resources/api-utilities.txt
Resource    ../../resources/api-variables.txt

*** Keywords ***
Calculate Air Fees-HK Commission
    Run Keyword If    "${client_type_value.upper()}" == "TP"    Set Test Variable    ${commission_amount}    0
    ...    ELSE    Calculate Air Fees-HK Commission With Client Type

Calculate Air Fees-HK Commission With Client Type
    ${nett_fare_commision_condition}    Evaluate    (${nett_fare_value}/(1-${commission_percentage_value}*0.01))-${nett_fare_value}
    ${commission_formula}    Set Variable If    ${nett_fare_commision_condition}>0 and "${client_type_value.upper()}" == "DU"    ((${nett_fare_value}/(1-${commission_percentage_value}*0.01)) -${nett_fare_value})+10    ((${nett_fare_value}/(1-${commission_percentage_value}*0.01)) -${nett_fare_value})
    ${calculated_value}    Evaluate    ${commission_formula}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${commission_amount}    ${calculated_value}

Calculate Air Fees-HK Discount
    ${discount_formula}    Set Variable If    "${client_type_value.upper()}" == "DU" or "${client_type_value.upper()}" == "DB"    (${nett_fare_value}+${commission_amount})*(${discount_percentage_value}*0.01)    "${client_type_value.upper()}" == "MN" or "${client_type_value.upper()}" == "TF" or "${client_type_value.upper()}" == "TP"    ${discount_value}    0
    ${calculated_value}    Evaluate    ${discount_formula}
    Comment    ${rounded_value}    Run Keyword If    "${client_type_value.upper()}" == "DU" or "${client_type_value.upper()}" == "DB" or "${client_type_value.upper()}" == "MN" or "${client_type_value.upper()}" == "TF" or "${client_type_value.upper()}" == "TP"    Round Down    ${calculated_value}    ${decimal_place}
    ...    ELSE    Set Variable    ${calculated_value}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${discount_amount}    ${calculated_value}

Calculate Air Fees-HK Merchant Fee
    ${uatp_not_exists}    Run Keyword And Return Status    Variable Should Not Exist    ${uatp_flag_value}
    Run Keyword If    "${uatp_not_exists}" == "True"    Set Test Variable    ${uatp_flag_value}    true
    Run Keyword If    "${uatp_flag_value}" == "true"    Calculate Air Fees-HK Merchant Fee With UATP
    ...    ELSE    Calculate Air Fees-HK Merchant Fee Without UATP

Calculate Air Fees-HK Merchant Fee With UATP
    ${merchant_fee_formula}    Set Variable If    "${country}" == "HK" and "${client_type_value.upper()}" == "TF"    ${transaction_fee_value}*(${merchant_fee_percentage_value}*0.01)    "${country}" == "HK" and "${client_type_value.upper()}" != "TF"    (${nett_fare_amount}-${nett_fare_original_value}-${tax_1_value}-${tax_2_value})*(${merchant_fee_percentage_value}*0.01)
    ${calculated_value}    Evaluate    ${merchant_fee_formula}
    Comment    ${calculated_value}    Round Up    ${calculated_value}    ${decimal_place}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    Comment    ${calculated_value}    Evaluate    abs(${calculated_value})
    ${calculated_value}    Set Variable If    ${calculated_value} < 0    0    ${calculated_value} == -0    0    ${calculated_value}
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${merchant_fee_amount}    ${calculated_value}

Calculate Air Fees-HK Merchant Fee Without UATP
    ${merchant_fee_formula}    Set Variable If    "${client_type_value.upper()}" == "TF" and "${tfincmf_flag_value}" == "true"    (${nett_fare_amount}+${transaction_fee_value})*(${merchant_fee_percentage_value}*0.01)    ${nett_fare_amount}*(${merchant_fee_percentage_value}*0.01)
    ${calculated_value}    Evaluate    ${merchant_fee_formula}
    Comment    ${calculated_value}    Round Up    ${calculated_value}    ${decimal_place}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${merchant_fee_amount}    ${calculated_value}

Calculate Air Fees-HK Nett Cost In EO
    Comment    ${rounded_value}    Run Keyword If    "${web_fare_selected_flag}" == "true"    Round Up    ${nett_fare_value}    ${decimal_place}
    ...    ELSE    Set Variable    ${nett_fare_value}
    ${calculated_value}    Evaluate    round(${nett_fare_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${nett_cost_amount}    ${calculated_value}

Calculate Air Fees-HK Nett Fare
    ${nett_fare_formula}    Set Variable If    "${client_type_value.upper()}" == "TF" or "${client_type_value.upper()}" == "MN"    ${selling_price_amount}+${tax_1_value}+${tax_2_value}    ${selling_price_amount}+${tax_1_value}+${tax_2_value}-${discount_amount}
    ${calculated_value}    Evaluate    ${nett_fare_formula}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${nett_fare_original_value}    ${nett_fare_value}
    Set Test Variable    ${nett_fare_amount}    ${calculated_value}

Calculate Air Fees-HK Selling Price With Commission Amount
    Comment    ${selling_price_formula}    Set Variable If    "${web_fare_flag_value}" == "true"    ${nett_fare_value}+${commission_value}
    ${calculated_value}    Evaluate    ${nett_fare_value}+${commission_value}
    Comment    ${rounded_value}    Run Keyword If    "${web_fare_selected_flag}" == "true"    Round Up    ${calculated_value}    ${decimal_place}
    ...    ELSE    Set Variable    ${calculated_value}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${selling_price_amount}    ${calculated_value}

Calculate Air Fees-HK Selling Price With Commission Percentage
    ${client_type_flag}    Set Variable If    "${client_type_value.upper()}" == "MG" or "${client_type_value.upper()}" == "DB" or "${client_type_value.upper()}" == "TF" or "${client_type_value.upper()}" == "MN"    true    false
    ${selling_price_formula}    Set Variable If    "${client_type_flag}" == "true" and "${web_fare_flag_value}" == "true"    ${nett_fare_value}/(1-(${commission_percentage_value}*0.01))    "${client_type_flag}" == "false" and "${web_fare_flag_value}" == "true"    ${nett_fare_value}/(1-(${commission_percentage_value}*0.01))+10    "${client_type_flag}" == "true" and "${web_fare_flag_value}" == "false"
    ...    ${nett_fare_value}/(1-(${commission_percentage_value}*0.01))    ${nett_fare_value}/(1-(${commission_percentage_value}*0.01))+10
    ${calculated_value}    Evaluate    ${selling_price_formula}
    Comment    ${rounded_value}    Run Keyword If    "${web_fare_selected_flag}" == "true"    Round Up    ${calculated_value}    ${decimal_place}
    ...    ELSE    Set Variable    ${calculated_value}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${selling_price_amount}    ${calculated_value}

Calculate Air Fees-HK Total Selling Fare With Formula
    ${calculated_value}    Evaluate    ${nett_fare_amount}+${merchant_fee_amount}
    Comment    ${rounded_value}    Run Keyword If    "${web_fare_selected_flag}" == "true"    Round Up    ${calculated_value}    ${decimal_place}
    ...    ELSE    Set Variable    ${calculated_value}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${total_selling_fare_amount}    ${calculated_value}

Calculate Air Fees-HK Total Selling Fare Without Formula
    ${calculated_value}    Evaluate    ${nett_fare_value}+${commission_value}-${discount_value}+${tax_1_value}+${tax_2_value}+${merchant_fee_value}
    Comment    ${rounded_value}    Run Keyword If    "${web_fare_selected_flag}" == "true"    Round Up    ${calculated_value}    ${decimal_place}
    ...    ELSE    Set Variable    ${calculated_value}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${total_selling_fare_amount}    ${calculated_value}
    
Calculate Air Fees-IN GST Amount
    ${gst_amount_formula}    Set Variable If    "${gst_amount_is_visible}" == "true" and "${exempt_tax}" == "false"    ((${gross_sell}+${yq_tax})*${tax_percentage})*3    0
    ${calculated_value}    Evaluate    ${gst_amount_formula}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}   
    Set Test Variable    ${gst_amount}    ${calculated_value} 
    
Calculate Air Fees-IN Reference Fare
    ${calculate_value}    Evaluate    ${base_fare}+${total_taxes} 
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}  
    Set Test Variable    ${reference_fare_amount}    ${calculate_value}      
    
Calculate Air Fees-IN Total Taxes
    ${calculated_value}    Evaluate    ${total_taxes}+${tax_1}+${tax_2}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${total_taxes_amount}    ${calculated_value}      

Calculate Air Fees-SG Commission
    ${commission_formula}    Set Variable If    "${commission_percent_flag_value}" == "true"    ${nett_fare_value}*(${commission_percentage_value}*0.01)    ${commission_value}
    ${calculated_value}    Evaluate    ${commission_formula}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${commission_amount}    ${calculated_value}

Calculate Air Fees-SG Discount
    ${client_type_flag}    Set Variable If    "${client_type_value.upper()}" == "DU" or "${client_type_value.upper()}" == "DB" or "${client_type_value.upper()}" == "TF" or "${client_type_value.upper()}" == "MN"    true    false
    ${discount_formula}    Set Variable If    "${client_type_flag}" == "true" and "${discount_percent_flag_value}" == "true"    ${nett_fare_value}*(${discount_percentage_value}*0.01)    "${client_type_flag}" == "true" and "${discount_percent_flag_value}" == "true"    0    ${discount_value}
    ${calculated_value}    Evaluate    ${discount_formula}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${discount_amount}    ${calculated_value}

Calculate Air Fees-SG Merchant Fee
    Run Keyword If    "${product_type_value.upper()}" == "CT"    Calculate Air Fees-SG Merchant Fee For Product Type CT
    ...    ELSE    Calculate Air Fees-SG Merchant Fee For Non-Product Type CT

Calculate Air Fees-SG Merchant Fee For Non-Product Type CT
    ${merchant_fee_formula}    Set Variable If    "${client_type_value.upper()}" == "TF" and "${tfincmf_flag_value}" == "true"    (${selling_price_value}-${discount_amount}+${tax_1_value}+${tax_2_value}+${transaction_fee_value})*(${merchant_fee_percentage_value}*0.01)    (${selling_price_value}-${discount_amount}+${tax_1_value}+${tax_2_value})*(${merchant_fee_percentage_value}*0.01)
    ${calculated_value}    Evaluate    ${merchant_fee_formula}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${merchant_fee_amount}    ${calculated_value}

Calculate Air Fees-SG Merchant Fee For Product Type CT
    ${merchant_fee_formula}    Set Variable If    "${client_type_value.upper()}" == "TF" and "${tfincmf_flag_value}" == "true"    (${nett_cost_amount}+${commission_amount}-${discount_amount}+${tax_1_value}+${tax_2_value}+${transaction_fee_value})*(${merchant_fee_percentage_value}*0.01)    (${nett_cost_amount}+${commission_amount}-${discount_amount}+${tax_1_value}+${tax_2_value})*(${merchant_fee_percentage_value}*0.01)
    ${calculated_value}    Evaluate    ${merchant_fee_formula}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${merchant_fee_amount}    ${calculated_value}

Calculate Air Fees-SG Nett Cost In EO With Formula
    ${calculated_value}    Evaluate    ${nett_fare_value}-${commission_amount}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${nett_cost_amount}    ${calculated_value}

Calculate Air Fees-SG Nett Cost In EO Without Formula
    ${calculated_value}    Evaluate    ${nett_fare_value}-${commission_value}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${nett_cost_amount}    ${calculated_value}

Calculate Air Fees-SG Total Selling Fare With Formula
    ${total_selling_fare_formula}    Set Variable If    "${product_type_value.upper()}" == "CT"    ${nett_cost_amount}+${commission_amount}-${discount_amount}+${tax_1_value}+${tax_2_value}+${merchant_fee_amount}    ${selling_price_value}-${discount_amount}+${tax_1_value}+${tax_2_value}+${merchant_fee_amount}
    ${calculated_value}    Evaluate    ${total_selling_fare_formula}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${total_selling_fare_amount}    ${calculated_value}

Calculate Air Fees-SG Total Selling Fare Without Formula
    ${total_selling_fare_formula}    Set Variable If    "${product_type_value.upper()}" == "CT"    ${nett_fare_value}-${discount_value}+${tax_1_value}+${tax_2_value}+${merchant_fee_value}    ${selling_price_value}-${discount_value}+${tax_1_value}+${tax_2_value}+${merchant_fee_value}
    ${calculated_value}    Evaluate    ${total_selling_fare_formula}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${total_selling_fare_amount}    ${calculated_value}

Create Test Variables For Air Fees-HK
    [Arguments]    ${fees_list}    ${country}
    ${fees_list}    Split String    ${fees_list}    |
    : FOR    ${fees}    IN    @{fees_list}
    \    ${fees_item}    Split String    ${fees}    ,
    \    Set Test Variable    ${${fees_item[0]}_value}    ${fees_item[1]}
    Set Test Variable    ${fees_list}
    Set Test Variable    ${country}    ${country.upper()}
    Set Test Variable    ${service_fee_name}    air-fees

Generate Test Variables For Air Fees-HK
    [Arguments]    ${fees_list}    ${country}
    Create Test Variables For Air Fees-HK    ${fees_list}    ${country}
    ${decimal_place}    Set Variable If    "${country.upper()}" == "SG"    2    0
    Set Test Variable    ${decimal_place}
    Run Keyword If    "${apply_formula_value}" == "true"    Generate Test Variables For Air Fees-HK With Formula
    ...    ELSE    Generate Test Variables For Air Fees-HK Without Formula
    Run Keyword If    "${country.upper()}" != "SG"    Remove Decimal Places For Air Fees-HK

Generate Test Variables For Air Fees-HK With Formula
    Run Keyword If    "${commission_percent_flag_value}" == "true"    Run Keywords    Calculate Air Fees-HK Commission
    ...    AND    Calculate Air Fees-HK Selling Price With Commission Percentage
    ...    ELSE    Run Keywords    Calculate Air Fees-HK Selling Price With Commission Amount
    ...    AND    Set Test Variable    ${commission_amount}    ${commission_value}
    Run Keyword If    "${discount_percent_flag_value}" == "true"    Calculate Air Fees-HK Discount
    ...    ELSE    Set Test Variable    ${discount_amount}    ${discount_value}
    Run Keyword If    "${discount_value}" == "${EMPTY}" or"${client_type_value}" == "TF" or"${client_type_value}" == "MN"    Set Test Variable    ${discount_amount}    0
    Set Test Variable    ${nett_cost_amount}    ${nett_fare_value}
    Calculate Air Fees-HK Nett Fare
    Run Keyword If    "${cwt_absorb_value}" == "false" and "${cc_value.upper()}" == "CX" and "${merchant_fee_waive_value}" == "false"    Calculate Air Fees-HK Merchant Fee
    ...    ELSE    Set Test Variable    ${merchant_fee_amount}    0
    Calculate Air Fees-HK Total Selling Fare With Formula

Generate Test Variables For Air Fees-HK Without Formula
    Calculate Air Fees-HK Total Selling Fare Without Formula
    Calculate Air Fees-HK Nett Cost In EO
    Set Test Variable    ${commission_amount}    ${commission_value}
    Set Test Variable    ${merchant_fee_amount}    ${merchant_fee_value}
    Set Test Variable    ${selling_price_amount}    0
    Set Test Variable    ${discount_amount}    ${discount_value}
    Set Test Variable    ${nett_fare_amount}    ${nett_fare_value}

Generate Test Variables For Air Fees-SG
    [Arguments]    ${fees_list}    ${country}
    Create Test Variables For Air Fees-HK    ${fees_list}    ${country}
    ${decimal_place}    Set Variable If    "${country.upper()}" == "SG"    2    0
    Set Test Variable    ${decimal_place}
    Run Keyword If    "${apply_formula_value}" == "true"    Generate Test Variables For Air Fees-SG With Formula
    ...    ELSE    Generate Test Variables For Air Fees-SG Without Formula

Generate Test Variables For Air Fees-SG With Formula
    Calculate Air Fees-SG Commission
    Calculate Air Fees-SG Discount
    Calculate Air Fees-SG Nett Cost In EO With Formula
    ${tfincmf_not_exists}    Run Keyword And Return Status    Variable Should Not Exist    ${tfincmf_flag_value}
    Run Keyword If    "${tfincmf_not_exists}" == "True"    Set Test Variable    ${tfincmf_flag_value}    false
    Run Keyword If    "${cwt_absorb_value}" == "false" and "${cc_value.upper()}" == "CX" and "${merchant_fee_waive_value}" == "false"    Calculate Air Fees-SG Merchant Fee
    ...    ELSE    Set Test Variable    ${merchant_fee_amount}    0
    Calculate Air Fees-SG Total Selling Fare With Formula

Generate Test Variables For Air Fees-SG Without Formula
    Calculate Air Fees-SG Total Selling Fare Without Formula
    Calculate Air Fees-SG Nett Cost In EO Without Formula
    Set Test Variable    ${merchant_fee_amount}    ${merchant_fee_value}

Remove Decimal Places For Air Fees-HK
    ${commission_amount}    Remove String    ${commission_amount}    .00
    ${merchant_fee_amount}    Remove String    ${merchant_fee_amount}    .00
    ${total_selling_fare_amount}    Remove String    ${total_selling_fare_amount}    .00
    ${nett_cost_amount}    Remove String    ${nett_cost_amount}    .00
    ${selling_price_amount}    Remove String    ${selling_price_amount}    .00
    ${discount_amount}    Remove String    ${discount_amount}    .00
    ${nett_fare_amount}    Remove String    ${nett_fare_amount}    .00
    Set Test Variable    ${commission_amount}
    Set Test Variable    ${merchant_fee_amount}
    Set Test Variable    ${total_selling_fare_amount}
    Set Test Variable    ${nett_cost_amount}
    Set Test Variable    ${selling_price_amount}
    Set Test Variable    ${discount_amount}
    Set Test Variable    ${nett_fare_amount}

Send Other Service Fees For Air Fees Post Request
    [Arguments]    ${token}=${default_token}
    Create Session    fees    ${${env}_base_url}    verify=True
    ${headers}    Run Keyword If    "${token}" != "None"    Create Dictionary    Content-Type=application/json    Authorization=Bearer ${token}
    ...    ELSE    Create Dictionary    Content-Type=application/json
    ${other_service_fees_request_list}    Create List
    ${length_country_code}    Get Length    ${country}
    Run Keyword If    ${length_country_code} > 2    Append To List    ${other_service_fees_request_list}    "countryCode":${country}
    ...    ELSE    Append To List    ${other_service_fees_request_list}    "countryCode":"${country}"
    Run Keyword If    "${cc_value}"!="null"    Append To List    ${other_service_fees_request_list}    "fopType":"${cc_value}"
    ${client_type}    Set Variable If    "${client_type_value}"=="NULL"    null    "${client_type_value}"=="None"    None    "${client_type_value}"
    Run Keyword If    "${client_type_value}"!="null"    Append To List    ${other_service_fees_request_list}    "clientType":${client_type}
    Run Keyword If    "${pro_name_value}"!="null"    Append To List    ${other_service_fees_request_list}    "profileName":"${pro_name_value}"
    Run Keyword If    "${merchant_fee_absorb_value}"!="null"    Append To List    ${other_service_fees_request_list}    "merchantFeeAbsorb":${merchant_fee_absorb_value}
    Run Keyword If    "${merchant_fee_waive_value}"!="null"    Append To List    ${other_service_fees_request_list}    "merchantFeeWaive":${merchant_fee_waive_value}
    Run Keyword If    "${apply_formula_value}"!="null"    Append To List    ${other_service_fees_request_list}    "applyFormula":${apply_formula_value}
    Run Keyword If    "${merchant_fee_value}"!="null"    Append To List    ${other_service_fees_request_list}    "merchantFee":${merchant_fee_value}
    Run Keyword If    "${commission_value}"!="null"    Append To List    ${other_service_fees_request_list}    "commission":${commission_value}
    Run Keyword If    "${commission_percent_flag_value}"!="null"    Append To List    ${other_service_fees_request_list}    "commissionByPercent":${commission_percent_flag_value}
    Run Keyword If    "${commission_percentage_value}"!="null"    Append To List    ${other_service_fees_request_list}    "commissionPercent":${commission_percentage_value}
    Run Keyword If    "${cwt_absorb_value}"!="null"    Append To List    ${other_service_fees_request_list}    "cwtAbsorb":${cwt_absorb_value}
    Run Keyword If    "${discount_value}"!="null"    Append To List    ${other_service_fees_request_list}    "discount":${discount_value}
    Run Keyword If    "${discount_percent_flag_value}"!="null"    Append To List    ${other_service_fees_request_list}    "discountByPercent":${discount_percent_flag_value}
    Run Keyword If    "${discount_percentage_value}"!="null"    Append To List    ${other_service_fees_request_list}    "discountPercent":${discount_percentage_value}
    Run Keyword If    "${nett_fare_value}"!="null"    Append To List    ${other_service_fees_request_list}    "nettFare":${nett_fare_value}
    ${product_type}    Set Variable If    "${product_type_value}"=="NULL"    null    "${product_type_value}"=="None"    None    "${product_type_value}"
    Run Keyword If    "${product_type_value}"!="null"    Append To List    ${other_service_fees_request_list}    "productType":${product_type}
    Run Keyword If    "${tax_1_value}"!="null"    Append To List    ${other_service_fees_request_list}    "tax1":${tax_1_value}
    Run Keyword If    "${tax_2_value}"!="null"    Append To List    ${other_service_fees_request_list}    "tax2":${tax_2_value}
    Run Keyword If    "${web_fare_flag_value}"!="null"    Append To List    ${other_service_fees_request_list}    "webFareSelected":${web_fare_flag_value}
    ${selling_price_exists}    Run Keyword If    "${country}"=="SG"    Run Keyword And Return Status    Variable Should Exist    ${selling_price_value}
    ...    ELSE    Set Variable    False
    Run Keyword If    "${selling_price_exists}"=="True"    Append To List    ${other_service_fees_request_list}    "sellingPrice":${selling_price_value}
    ${transaction_fee_exists}    Run Keyword And Return Status    Variable Should Exist    ${transaction_fee_value}
    Run Keyword If    "${transaction_fee_exists}"=="True"    Append To List    ${other_service_fees_request_list}    "transactionFee":${transaction_fee_value}
    ${uatp_exists}    Run Keyword And Return Status    Variable Should Exist    ${uatp_flag_value}
    Run Keyword If    "${uatp_exists}"=="True"    Append To List    ${other_service_fees_request_list}    "uatp":${uatp_flag_value}
    ${list_count}    Get Length    ${other_service_fees_request_list}
    : FOR    ${i}    IN RANGE    0    ${list_count}
    \    ${fees_list}    Set Variable If    ${i}==0    ${EMPTY}    ${fees_list},
    \    ${fees_list}    Set Variable    ${fees_list}${other_service_fees_request_list[${i}]}
    ${data}    Set Variable    {${fees_list}}
    Log    ${data}
    ${response}    Post Request    fees    /apac-services-rest/api/other-service-fees/air-fees    data=${data}    headers=${headers}
    Set Test Variable    ${response}
    Log    ${response.headers}
    Log    ${response.content}
    Set Test Variable    ${api_flag}    fees

Verify Calculated Air Fees Are Not Returned Correctly
    Verify String Does Not Contain Substring    ${response.content}    "commission"
    Verify String Does Not Contain Substring    ${response.content}    "totalSellingFare"
    Verify String Does Not Contain Substring    ${response.content}    "nettCost"
    Verify String Does Not Contain Substring    ${response.content}    "sellingPrice"
    Verify String Does Not Contain Substring    ${response.content}    "merchantFee"
    Verify String Does Not Contain Substring    ${response.content}    "discount"
    Verify String Does Not Contain Substring    ${response.content}    "nettFare"

Verify Calculated Air Fees Are Returned Correctly
    ${data}    Remove String    ${response.text}    {
    ${data}    Remove String    ${data}    }
    ${data}    Remove String    ${data}    "
    ${data_list}    Split String    ${data}    ,
    : FOR    ${item}    IN    @{data_list}
    \    ${items}    Split String    ${item}    :
    \    Verify Actual Numerical Value Matches Expected Numerical Value    ${items[1]}    ${${items[0]}_amount}

Verify Response Does Not Contain Calculated Fee
    [Arguments]    ${element}
    Verify String Does Not Contain Substring    ${response.content}    "${element}"
