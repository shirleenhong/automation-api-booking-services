*** Settings ***
Resource    ../../resources/api-imports.txt
Resource    ../../resources/api-utilities.txt
Resource    ../../resources/api-variables.txt

*** Keywords ***
Calculate Air Fees-HK Commission
    Run Keyword If    "${client_type_value.upper()}" == "TP"    Set Test Variable    ${commission_amount}    0
    ...    ELSE    Calculate Air Fees-HK Commission With Client Type

Calculate Air Fees-HK Commission With Client Type
    ${nett_fare_commision_condition}    Evaluate    (${nett_fare_value}/(1-${commission_percentage_value}*0.01))-${nett_fare_value}
    ${commission_formula}    Set Variable If    ${nett_fare_commision_condition}>0 and "${client_type_value.upper()}" == "DU"    ((${nett_fare_value}/(1-${commission_percentage_value}*0.01)) -${nett_fare_value})+10    ((${nett_fare_value}/(1-${commission_percentage_value}*0.01)) -${nett_fare_value})
    ${calculated_value}    Evaluate    ${commission_formula}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${commission_amount}    ${calculated_value}

Calculate Air Fees-HK Discount
    ${discount_formula}    Set Variable If    "${client_type_value.upper()}" == "DU" or "${client_type_value.upper()}" == "DB"    (${nett_fare_value}+${commission_amount})*(${discount_percentage_value}*0.01)    "${client_type_value.upper()}" == "MN" or "${client_type_value.upper()}" == "TF" or "${client_type_value.upper()}" == "TP"    ${discount_value}    0
    ${calculated_value}    Evaluate    ${discount_formula}
    Comment    ${rounded_value}    Run Keyword If    "${client_type_value.upper()}" == "DU" or "${client_type_value.upper()}" == "DB" or "${client_type_value.upper()}" == "MN" or "${client_type_value.upper()}" == "TF" or "${client_type_value.upper()}" == "TP"    Round Down    ${calculated_value}    ${decimal_place}
    ...    ELSE    Set Variable    ${calculated_value}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${discount_amount}    ${calculated_value}

Calculate Air Fees-HK Merchant Fee
    ${uatp_not_exists}    Run Keyword And Return Status    Variable Should Not Exist    ${uatp_flag_value}
    Run Keyword If    "${uatp_not_exists}" == "True"    Set Test Variable    ${uatp_flag_value}    true
    Run Keyword If    "${uatp_flag_value}" == "true"    Calculate Air Fees-HK Merchant Fee With UATP
    ...    ELSE    Calculate Air Fees-HK Merchant Fee Without UATP

Calculate Air Fees-HK Merchant Fee With UATP
    ${merchant_fee_formula}    Set Variable If    "${country}" == "hk" and "${client_type_value.upper()}" == "TF"    ${transaction_fee_value}*(${merchant_fee_percentage_value}*0.01)    "${country}" == "hk" and "${client_type_value.upper()}" != "TF"    (${nett_fare_amount}-${nett_fare_original_value}-${tax_1_value}-${tax_2_value})*(${merchant_fee_percentage_value}*0.01)
    ${calculated_value}    Evaluate    ${merchant_fee_formula}
    Comment    ${calculated_value}    Round Up    ${calculated_value}    ${decimal_place}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    Comment    ${calculated_value}    Evaluate    abs(${calculated_value})
    ${calculated_value}    Set Variable If    ${calculated_value} < 0    0    ${calculated_value} == -0    0    ${calculated_value}
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${merchant_fee_amount}    ${calculated_value}

Calculate Air Fees-HK Merchant Fee Without UATP
    ${merchant_fee_formula}    Set Variable If    "${client_type_value.upper()}" == "TF" and "${tfincmf_flag_value}" == "true"    (${nett_fare_amount}+${transaction_fee_value})*(${merchant_fee_percentage_value}*0.01)    ${nett_fare_amount}*(${merchant_fee_percentage_value}*0.01)
    ${calculated_value}    Evaluate    ${merchant_fee_formula}
    Comment    ${calculated_value}    Round Up    ${calculated_value}    ${decimal_place}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${merchant_fee_amount}    ${calculated_value}

Calculate Air Fees-HK Nett Cost In EO
    Comment    ${rounded_value}    Run Keyword If    "${web_fare_selected_flag}" == "true"    Round Up    ${nett_fare_value}    ${decimal_place}
    ...    ELSE    Set Variable    ${nett_fare_value}
    ${calculated_value}    Evaluate    round(${nett_fare_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${nett_cost_amount}    ${calculated_value}

Calculate Air Fees-HK Nett Fare
    ${nett_fare_formula}    Set Variable If    "${client_type_value.upper()}" == "TF" or "${client_type_value.upper()}" == "MN"    ${selling_price_amount}+${tax_1_value}+${tax_2_value}    ${selling_price_amount}+${tax_1_value}+${tax_2_value}-${discount_amount}
    ${calculated_value}    Evaluate    ${nett_fare_formula}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${nett_fare_original_value}    ${nett_fare_value}
    Set Test Variable    ${nett_fare_amount}    ${calculated_value}

Calculate Air Fees-HK Selling Price With Commission Amount
    Comment    ${selling_price_formula}    Set Variable If    "${web_fare_flag_value}" == "true"    ${nett_fare_value}+${commission_value}
    ${calculated_value}    Evaluate    ${nett_fare_value}+${commission_value}
    Comment    ${rounded_value}    Run Keyword If    "${web_fare_selected_flag}" == "true"    Round Up    ${calculated_value}    ${decimal_place}
    ...    ELSE    Set Variable    ${calculated_value}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${selling_price_amount}    ${calculated_value}

Calculate Air Fees-HK Selling Price With Commission Percentage
    ${client_type_flag}    Set Variable If    "${client_type_value.upper()}" == "MG" or "${client_type_value.upper()}" == "DB" or "${client_type_value.upper()}" == "TF" or "${client_type_value.upper()}" == "MN"    true    false
    ${selling_price_formula}    Set Variable If    "${client_type_flag}" == "true" and "${web_fare_flag_value}" == "true"    ${nett_fare_value}/(1-(${commission_percentage_value}*0.01))    "${client_type_flag}" == "false" and "${web_fare_flag_value}" == "true"    ${nett_fare_value}/(1-(${commission_percentage_value}*0.01))+10    "${client_type_flag}" == "true" and "${web_fare_flag_value}" == "false"
    ...    ${nett_fare_value}/(1-(${commission_percentage_value}*0.01))    ${nett_fare_value}/(1-(${commission_percentage_value}*0.01))+10
    ${calculated_value}    Evaluate    ${selling_price_formula}
    Comment    ${rounded_value}    Run Keyword If    "${web_fare_selected_flag}" == "true"    Round Up    ${calculated_value}    ${decimal_place}
    ...    ELSE    Set Variable    ${calculated_value}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${selling_price_amount}    ${calculated_value}

Calculate Air Fees-HK Total Selling Fare With Formula
    ${calculated_value}    Evaluate    ${nett_fare_amount}+${merchant_fee_amount}
    Comment    ${rounded_value}    Run Keyword If    "${web_fare_selected_flag}" == "true"    Round Up    ${calculated_value}    ${decimal_place}
    ...    ELSE    Set Variable    ${calculated_value}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${total_selling_fare_amount}    ${calculated_value}

Calculate Air Fees-HK Total Selling Fare Without Formula
    ${calculated_value}    Evaluate    ${nett_fare_value}+${commission_value}-${discount_value}+${tax_1_value}+${tax_2_value}+${merchant_fee_value}
    Comment    ${rounded_value}    Run Keyword If    "${web_fare_selected_flag}" == "true"    Round Up    ${calculated_value}    ${decimal_place}
    ...    ELSE    Set Variable    ${calculated_value}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${total_selling_fare_amount}    ${calculated_value}  
    
Calculate Air Fees-IN Mechant Fee On TF International
    ${merchant_fee_on_tf_formula}    Set Variable If    "${air_pricing_id}" == "26" or "${air_pricing_id}" == "28" or "${air_pricing_id}" == "29"    0    (${transaction_fee_amount}+${total_gst_on_tf_amount})*(${merchant_fee_percentage_value}*0.01)        
    ${calculated_value}    Evaluate   ${merchant_fee_on_tf_formula}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}   
    Set Test Variable    ${merchant_fee_on_tf_amount}    ${calculated_value}
    
Calculate Air Fees-IN Mechant Fee On TF Domestic
    ${merchant_fee_on_tf_formula}    Set Variable If    "${air_pricing_id}" == "26" or "${air_pricing_id}" == "28"    0    ${transaction_fee_amount}*(${merchant_fee_percentage_value}*0.01)        
    ${calculated_value}    Evaluate   ${merchant_fee_on_tf_formula}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}   
    Set Test Variable    ${merchant_fee_on_tf_amount}    ${calculated_value}  
    
Calculate Air Fees-IN Reference Fare
    ${calculated_value}    Evaluate    ${base_fare_value}+${total_taxes_amount} 
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}  
    Set Test Variable    ${reference_fare_amount}    ${calculated_value} 
    
Calculate Air Fees-IN Total Airline Commission
    ${calculated_value}    Evaluate    (${base_fare_value}+${yq_tax_value})*(${airline_commission_value}*0.01)
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}  
    Set Test Variable    ${total_airline_commission_amount}    ${calculated_value}
    
Calculate Air Fees-IN Total Charge
    ${total_charge_formula}    Set Variable If    "${air_pricing_id}" == "26"    ${total_sell_fare_amount}+${total_gst_amount}+${total_merchant_fee_amount}+${total_taxes_amount}    "${air_pricing_id}" == "28"    ${total_sell_fare_amount}-${total_discount_amount}+${total_gst_amount}+${total_merchant_fee_amount}+${transaction_fee_amount}+${total_taxes_amount}    ${total_sell_fare_amount}-${total_discount_amount}+${total_gst_amount}+${total_merchant_fee_amount}+${merchant_fee_on_tf_amount}+${transaction_fee_amount}+${total_taxes_amount}
    ${calculated_value}    Evaluate    ${total_charge_formula}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}  
    Set Test Variable    ${total_charge_amount}    ${calculated_value}
    
Calculate Air Fees-IN Total Discount
    ${total_discount_formula}    Set Variable If    "${air_pricing_id}" != "26" and "${trip_type_value}" == "I"    (${total_airline_commission_amount}*(${discount_percentage_value}*0.01))+${total_overhead_commission_amount}    "${air_pricing_id}" != "26" and "${trip_type_value}" != "I"    ${total_airline_commission_amount}*(${discount_percentage_value}*0.01)    ${EMPTY}
    ${calculated_value}    Run Keyword If    "${total_discount_formula}" != "${EMPTY}"    Evaluate    ${total_discount_formula}
    ${calculated_value}    Run Keyword If    "${total_discount_formula}" != "${EMPTY}"    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}  
    Run Keyword If    "${calculated_value}" != "None"    Set Test Variable    ${total_discount_amount}    ${calculated_value}
    
Calculate Air Fees-IN Total Fee
    ${total_fee_formula}    Set Variable If     "${air_pricing_id}" == "21"    ${base_fare_value}+${total_taxes_amount}    "${air_pricing_id}" == "22"    ${base_fare_value}-${total_airline_commission_amount}-${total_overhead_commission_amount}    "${air_pricing_id}" == "23"    ${base_fare_value}+${total_taxes_amount}+${total_gst_amount}    "${air_pricing_id}" == "24"    ${base_fare_value}-${total_airline_commission_amount}    "${air_pricing_id}" == "25"    ${base_fare_value}    "${air_pricing_id}" == "27"    ${base_fare_value}+${total_taxes_amount}+${total_gst_amount}-${total_airline_commission_amount}-${total_overhead_commission_amount}    "${air_pricing_id}" == "30"    ${base_fare_value}+${yq_tax_value}    ${EMPTY}   
    ${calculated_value}    Run Keyword If    "${total_fee_formula}" != "${EMPTY}"    Evaluate    ${total_fee_formula}
    ${calculated_value}    Run Keyword If    "${total_fee_formula}" != "${EMPTY}"    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}  
    Run Keyword If    "${calculated_value}" != "None"    Set Test Variable    ${base_amount_amount}    ${calculated_value}    ELSE    Set Test Variable    ${base_amount_amount}    ${base_fare_value}   
    
Calculate Air Fees-IN Total GST
    ${calculated_value}    Evaluate    ((${base_fare_value}+${yq_tax_value})*(${products_gst_percentage_value}*0.01))+((${base_fare_value}+${yq_tax_value})*(${products_ot1_percentage_value}*0.01))+((${base_fare_value}+${yq_tax_value})*(${products_ot2_percentage_value}*0.01))
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}   
    Set Test Variable    ${total_gst_amount}    ${calculated_value}
    
Calculate Air Fees-IN Total GST On TF
    ${calculated_value}    Evaluate    ${transaction_fee_amount}*(${in_air_product_gst_percentage}*0.01)
    ${calculated_value}    Evaluate    ${calculated_value}+(${transaction_fee_amount}*(${in_air_product_ot1_percentage}*0.01))
    ${calculated_value}    Evaluate    ${calculated_value}+(${transaction_fee_amount}*(${in_air_product_ot2_percentage}*0.01))
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}   
    Set Test Variable    ${total_gst_on_tf_amount}    ${calculated_value} 
    
Calculate Air Fees-IN Total Markup
    Set Test Variable    ${total_markup_amount}    ${EMPTY}
    
Calculate Air Fees-IN Total Merchant Fee
    ${merchant_fee_formula}    Set Variable If    "${air_pricing_id}" != "26"    (${total_sell_fare_amount}-${total_discount_amount}+${total_taxes_amount}+${total_gst_amount})*(${merchant_fee_percentage_value}*0.01)    (${total_sell_fare_amount}+${total_taxes_amount}+${total_gst_amount})*(${merchant_fee_percentage_value}*0.01)          
    ${calculated_value}    Evaluate   ${merchant_fee_formula}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}   
    Set Test Variable    ${total_merchant_fee_amount}    ${calculated_value}
    
Calculate Air Fees-IN Total Overhead Commission
    Run Keyword If    "${airline_overhead_commission_by_percent_value}" == "true"  Calculate Air Fees-IN Total Overhead Commission Percent    ELSE    Calculate Air Fees-IN Total Overhead Commission Amount  
    
Calculate Air Fees-IN Total Overhead Commission Percent
    ${total_overhead_commission_formula}    Set Variable If    "${air_pricing_id}" != "26" and "${trip_type_value}" == "I"    ((${base_fare_value}-${total_airline_commission_amount})*(${airline_overhead_commission_percentage_value}*0.01))*(${client_overhead_commission_percentage_value}*0.01)    ${EMPTY}          
    ${calculated_value}    Run Keyword If    "${total_overhead_commission_formula}" != "${EMPTY}"    Evaluate   ${total_overhead_commission_formula}    
    ${calculated_value}    Run Keyword If    "${total_overhead_commission_formula}" != "${EMPTY}"    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}   
    Run Keyword If    "${calculated_value}" != "None"    Set Test Variable    ${total_overhead_commission_amount}    ${calculated_value} 
    
Calculate Air Fees-IN Total Overhead Commission Amount
    ${total_overhead_commission_formula}    Set Variable If    "${air_pricing_id}" != "26" and "${trip_type_value}" == "I"    ${airline_overhead_commission_value}*(${client_overhead_commission_percentage_value}*0.01)    ${EMPTY}          
    ${calculated_value}    Run Keyword If    "${total_overhead_commission_formula}" != "${EMPTY}"    Evaluate   ${total_overhead_commission_formula}    
    ${calculated_value}    Run Keyword If    "${total_overhead_commission_formula}" != "${EMPTY}"    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}   
    Run Keyword If    "${calculated_value}" != "None"    Set Test Variable    ${total_overhead_commission_amount}    ${calculated_value} 
    
Calculate Air Fees-IN Total Sell Fare
    Set Test Variable    ${total_sell_fare_amount}    ${base_fare_value}
    
Calculate Air Fees-IN Total Selling Fare
    ${total_selling_fare_formula}    Set Variable If    "${air_pricing_id}" != "26"    ${total_sell_fare_amount}-${total_discount_amount}+${total_gst_amount}+${total_merchant_fee_amount}    ${total_sell_fare_amount}+${total_gst_amount}+${total_merchant_fee_amount}          
    ${calculated_value}    Evaluate   ${total_selling_fare_formula}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}   
    Set Test Variable    ${total_selling_fare_amount}    ${calculated_value} 
           
Calculate Air Fees-IN Total Taxes
    ${calculated_value}    Evaluate    ${yq_tax_value}+${tax_1_value}+${tax_2_value}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${total_taxes_amount}    ${calculated_value} 
    
Calculate Air Fees-IN Transaction Fee By Coupon
    Run Keyword If    ${air_segment_count_value}>0    Calculate Air Fees-IN Transaction Fee By Coupon List    ELSE    Set Test Variable    ${transaction_fee_amount}    0    
    
Calculate Air Fees-IN Transaction Fee By Coupon List
    ${tf_value}    Set Variable    0
    ${coupon_list}    Split String    ${tf_by_coupon_list_value}    ;
    : FOR    ${coupon}    IN    @{coupon_list}
    \    ${tf_by_coupon_formula}    Set Variable If    "${coupon.upper()}" == "GROUP"    ${tf_value}+${tf_by_coupon_amount_value}    ${tf_by_coupon_amount_value}
    \    ${tf_value}    Evaluate    ${tf_by_coupon_formula}
    ${calculated_value}    Evaluate    round(${tf_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${transaction_fee_amount}    ${calculated_value}
    
Calculate Air Fees-IN Transaction Fee By PNR
    Set Test Variable    ${transaction_fee_amount}    ${tf_by_pnr_amount_value} 
    
Calculate Air Fees-IN Transaction Fee By Tkt
    ${tf_by_tkt_formula}    Set Variable If    "${tf_by_tkt_operator_value}" == "F"    ${tf_by_tkt_amount_value}+${extra_amount_value}    "${tf_by_tkt_operator_value}" == "M"    (${base_amount_amount}*(${per_amount_value}*0.01))+${extra_amount_value}    "${tf_by_tkt_operator_value}" == "D"    (${base_amount_amount}/((100-${per_amount_value})*0.01)+${extra_amount_value})-${base_amount_amount}
    ${calculated_value}    Evaluate    ${tf_by_tkt_formula}
    ${calculated_value}    Set Variable If    ${max_amount_value} != 0 and ${calculated_value}>${max_amount_value}    ${max_amount_value}    ${calculated_value}
    ${calculated_value}    Set Variable If    ${calculated_value}<${min_amount_value}    ${min_amount_value}    ${calculated_value}   
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${transaction_fee_amount}    ${calculated_value}      

Calculate Air Fees-SG Commission
    ${commission_formula}    Set Variable If    "${commission_percent_flag_value}" == "true"    ${nett_fare_value}*(${commission_percentage_value}*0.01)    ${commission_value}
    ${calculated_value}    Evaluate    ${commission_formula}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${commission_amount}    ${calculated_value}

Calculate Air Fees-SG Discount
    ${client_type_flag}    Set Variable If    "${client_type_value.upper()}" == "DU" or "${client_type_value.upper()}" == "DB" or "${client_type_value.upper()}" == "TF" or "${client_type_value.upper()}" == "MN"    true    false
    ${discount_formula}    Set Variable If    "${client_type_flag}" == "true" and "${discount_percent_flag_value}" == "true"    ${nett_fare_value}*(${discount_percentage_value}*0.01)    "${client_type_flag}" == "true" and "${discount_percent_flag_value}" == "true"    0    ${discount_value}
    ${calculated_value}    Evaluate    ${discount_formula}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${discount_amount}    ${calculated_value}

Calculate Air Fees-SG Merchant Fee
    Run Keyword If    "${product_type_value.upper()}" == "CT"    Calculate Air Fees-SG Merchant Fee For Product Type CT
    ...    ELSE    Calculate Air Fees-SG Merchant Fee For Non-Product Type CT

Calculate Air Fees-SG Merchant Fee For Non-Product Type CT
    ${merchant_fee_formula}    Set Variable If    "${client_type_value.upper()}" == "TF" and "${tfincmf_flag_value}" == "true"    (${selling_price_value}-${discount_amount}+${tax_1_value}+${tax_2_value}+${transaction_fee_value})*(${merchant_fee_percentage_value}*0.01)    (${selling_price_value}-${discount_amount}+${tax_1_value}+${tax_2_value})*(${merchant_fee_percentage_value}*0.01)
    ${calculated_value}    Evaluate    ${merchant_fee_formula}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${merchant_fee_amount}    ${calculated_value}

Calculate Air Fees-SG Merchant Fee For Product Type CT
    ${merchant_fee_formula}    Set Variable If    "${client_type_value.upper()}" == "TF" and "${tfincmf_flag_value}" == "true"    (${nett_cost_amount}+${commission_amount}-${discount_amount}+${tax_1_value}+${tax_2_value}+${transaction_fee_value})*(${merchant_fee_percentage_value}*0.01)    (${nett_cost_amount}+${commission_amount}-${discount_amount}+${tax_1_value}+${tax_2_value})*(${merchant_fee_percentage_value}*0.01)
    ${calculated_value}    Evaluate    ${merchant_fee_formula}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${merchant_fee_amount}    ${calculated_value}

Calculate Air Fees-SG Nett Cost In EO With Formula
    ${calculated_value}    Evaluate    ${nett_fare_value}-${commission_amount}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${nett_cost_amount}    ${calculated_value}

Calculate Air Fees-SG Nett Cost In EO Without Formula
    ${calculated_value}    Evaluate    ${nett_fare_value}-${commission_value}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${nett_cost_amount}    ${calculated_value}

Calculate Air Fees-SG Total Selling Fare With Formula
    ${total_selling_fare_formula}    Set Variable If    "${product_type_value.upper()}" == "CT"    ${nett_cost_amount}+${commission_amount}-${discount_amount}+${tax_1_value}+${tax_2_value}+${merchant_fee_amount}    ${selling_price_value}-${discount_amount}+${tax_1_value}+${tax_2_value}+${merchant_fee_amount}
    ${calculated_value}    Evaluate    ${total_selling_fare_formula}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${total_selling_fare_amount}    ${calculated_value}

Calculate Air Fees-SG Total Selling Fare Without Formula
    ${total_selling_fare_formula}    Set Variable If    "${product_type_value.upper()}" == "CT"    ${nett_fare_value}-${discount_value}+${tax_1_value}+${tax_2_value}+${merchant_fee_value}    ${selling_price_value}-${discount_value}+${tax_1_value}+${tax_2_value}+${merchant_fee_value}
    ${calculated_value}    Evaluate    ${total_selling_fare_formula}
    ${calculated_value}    Evaluate    round(${calculated_value},${decimal_place})
    ${calculated_value}    Convert To String    ${calculated_value}
    ${calculated_value}    Fix Decimal Places    ${calculated_value}
    Set Test Variable    ${total_selling_fare_amount}    ${calculated_value}
    
Create Dictionary For Clients
    ${clients_dict}    Create Dictionary    3098300014.air_pricing_id=20    9000000009.air_pricing_id=20    90000000014.air_pricing_id=20    9000000008.air_pricing_id=20    9000000010.air_pricing_id=21    9000000007.air_pricing_id=21    9000000011.air_pricing_id=21    9000000012.air_pricing_id=22    9000000013.air_pricing_id=22    9000000014.air_pricing_id=22    9000000015.air_pricing_id=23    9000000016.air_pricing_id=23    9000000017.air_pricing_id=23    9000000018.air_pricing_id=24    9000000019.air_pricing_id=24    9000000020.air_pricing_id=24    9000000021.air_pricing_id=25    9000000022.air_pricing_id=25    9000000023.air_pricing_id=25    9000000024.air_pricing_id=26    9000000025.air_pricing_id=26    9000000026.air_pricing_id=26    9000000027.air_pricing_id=27    9000000028.air_pricing_id=27    9000000029.air_pricing_id=27    9000000030.air_pricing_id=28    9000000031.air_pricing_id=28    9000000032.air_pricing_id=28    9000000033.air_pricing_id=29    9000000034.air_pricing_id=29    9000000035.air_pricing_id=29    9000000036.air_pricing_id=30    9000000037.air_pricing_id=30    9000000038.air_pricing_id=30    9000000039.air_pricing_id=20    9000000040.air_pricing_id=20    9000000041.air_pricing_id=20    9000000042.air_pricing_id=20    9000000043.air_pricing_id=20    9000000044.air_pricing_id=20    9000000045.air_pricing_id=20    9000000046.air_pricing_id=20    9000000047.air_pricing_id=20    9000000048.air_pricing_id=30    9000000049.air_pricing_id=30    9000000050.air_pricing_id=20    9000000051.air_pricing_id=20    9000000052.air_pricing_id=20    9000000053.air_pricing_id=20    9000000054.air_pricing_id=20    9000000055.air_pricing_id=20    9000000056.air_pricing_id=20    9000000057.air_pricing_id=20    9000000058.air_pricing_id=20    9000000059.air_pricing_id=20    9000000060.air_pricing_id=20    9000000061.air_pricing_id=20    9000000062.air_pricing_id=20    9000000063.air_pricing_id=20    9000000064.air_pricing_id=20    9000000065.air_pricing_id=20
    Set Suite Variable    ${clients_dict}    

Create Test Variables For Air Fees-HK
    [Arguments]    ${fees_list}    ${country}
    ${fees_list}    Split String    ${fees_list}    |
    : FOR    ${fees}    IN    @{fees_list}
    \    ${fees_item}    Split String    ${fees}    ,
    \    Set Test Variable    ${${fees_item[0]}_value}    ${fees_item[1]}
    Set Test Variable    ${fees_list}
    Set Test Variable    ${country}    ${country.lower()}
    Set Test Variable    ${service_fee_name}    air-fees

Generate Test Variables For Air Fees-HK
    [Arguments]    ${fees_list}    ${country}
    Create Test Variables For Air Fees-HK    ${fees_list}    ${country}
    ${decimal_place}    Set Variable If    "${country.lower()}" == "sg"    2    0
    Set Test Variable    ${decimal_place}
    Run Keyword If    "${apply_formula_value}" == "true"    Generate Test Variables For Air Fees-HK With Formula
    ...    ELSE    Generate Test Variables For Air Fees-HK Without Formula
    Run Keyword If    "${country.lower()}" != "sg"    Remove Decimal Places For Air Fees-HK

Generate Test Variables For Air Fees-HK With Formula
    Run Keyword If    "${commission_percent_flag_value}" == "true"    Run Keywords    Calculate Air Fees-HK Commission
    ...    AND    Calculate Air Fees-HK Selling Price With Commission Percentage
    ...    ELSE    Run Keywords    Calculate Air Fees-HK Selling Price With Commission Amount
    ...    AND    Set Test Variable    ${commission_amount}    ${commission_value}
    Run Keyword If    "${discount_percent_flag_value}" == "true"    Calculate Air Fees-HK Discount
    ...    ELSE    Set Test Variable    ${discount_amount}    ${discount_value}
    Run Keyword If    "${discount_value}" == "${EMPTY}" or"${client_type_value}" == "TF" or"${client_type_value}" == "MN"    Set Test Variable    ${discount_amount}    0
    Set Test Variable    ${nett_cost_amount}    ${nett_fare_value}
    Calculate Air Fees-HK Nett Fare
    Run Keyword If    "${cwt_absorb_value}" == "false" and "${cc_value.upper()}" == "CX4" and "${merchant_fee_waive_value}" == "false"    Calculate Air Fees-HK Merchant Fee
    ...    ELSE    Set Test Variable    ${merchant_fee_amount}    0
    Calculate Air Fees-HK Total Selling Fare With Formula

Generate Test Variables For Air Fees-HK Without Formula
    Calculate Air Fees-HK Total Selling Fare Without Formula
    Calculate Air Fees-HK Nett Cost In EO
    Set Test Variable    ${commission_amount}    ${commission_value}
    Set Test Variable    ${merchant_fee_amount}    ${merchant_fee_value}
    Set Test Variable    ${selling_price_amount}    0
    Set Test Variable    ${discount_amount}    ${discount_value}
    Set Test Variable    ${nett_fare_amount}    ${nett_fare_value}
    
Generate Test Variables For Air Fees-IN
    [Arguments]    ${fees_list}    ${country}
    Create Test Variables For Air Fees-HK    ${fees_list}    ${country}
    Set Test Variable    ${air_pricing_id}    ${clients_dict["${client_account_number_value}.air_pricing_id"]}
    ${decimal_place}    Set Variable If    "${country.lower()}" == "hk"    0    2
    Set Test Variable    ${decimal_place}
    ${total_gst_amount}    Set Variable If    "${gst_enabled_value}" == "true"    0
    Run Keyword If    "${include_yq_comm_value}" == "false"    Set Test Variable    ${yq_tax_value}    0
    Run Keyword If    "${exempt_tax_value}" == "false" and "${gst_enabled_value}" == "true"    Calculate Air Fees-IN Total GST    ELSE    Set Test Variable    ${total_gst_amount}    0
    Run Keyword If    "${commission_enabled_value}" == "true"   Calculate Air Fees-IN Total Airline Commission    ELSE    Set Test Variable    ${total_airline_commission_amount}    0
    Run Keyword If    "${trip_type_value}" == "I" and "${overhead_commission_enabled_value}" == "true"    Calculate Air Fees-IN Total Overhead Commission    ELSE    Set Test Variable    ${total_overhead_commission_amount}    0
    Comment    Calculate Air Fees-IN Total Markup
    Run Keyword If    "${discount_enabled_value}" == "true"    Calculate Air Fees-IN Total Discount    ELSE    Set Test Variable    ${total_discount_amount}    0
    Calculate Air Fees-IN Total Taxes
    Calculate Air Fees-IN Total Sell Fare
    Calculate Air Fees-IN Total Fee
    ${calculate_fee_flag}    Set Variable If    "${fee_override_value}" == "false" and "${apply_fee_value}" != "NA"    true    false
    Run Keyword If    "${calculate_fee_flag}" == "true" and "${fee_option_value}" == "P"    Calculate Air Fees-IN Transaction Fee By PNR    ELSE IF    "${calculate_fee_flag}" == "true" and "${fee_option_value}" == "C"    Calculate Air Fees-IN Transaction Fee By Coupon    ELSE IF    "${calculate_fee_flag}" == "true" and "${fee_option_value}" == "T"    Calculate Air Fees-IN Transaction Fee By Tkt    ELSE    Set Test Variable    ${transaction_fee_amount}    ${transaction_fee_value}    
    Calculate Air Fees-IN Total Merchant Fee
    Calculate Air Fees-IN Total GST On TF
    Run Keyword If    "${trip_type_value}" == "I"    Calculate Air Fees-IN Mechant Fee On TF International    ELSE    Calculate Air Fees-IN Mechant Fee On TF Domestic
    Calculate Air Fees-IN Total Selling Fare
    Calculate Air Fees-IN Total Charge

Generate Test Variables For Air Fees-SG
    [Arguments]    ${fees_list}    ${country}
    Create Test Variables For Air Fees-HK    ${fees_list}    ${country}
    ${decimal_place}    Set Variable If    "${country.lower()}" == "sg"    2    0
    Set Test Variable    ${decimal_place}
    Run Keyword If    "${apply_formula_value}" == "true"    Generate Test Variables For Air Fees-SG With Formula
    ...    ELSE    Generate Test Variables For Air Fees-SG Without Formula

Generate Test Variables For Air Fees-SG With Formula
    Calculate Air Fees-SG Commission
    Calculate Air Fees-SG Discount
    Calculate Air Fees-SG Nett Cost In EO With Formula
    ${tfincmf_not_exists}    Run Keyword And Return Status    Variable Should Not Exist    ${tfincmf_flag_value}
    Run Keyword If    "${tfincmf_not_exists}" == "True"    Set Test Variable    ${tfincmf_flag_value}    false
    Run Keyword If    "${cwt_absorb_value}" == "false" and "${cc_value.upper()}" == "CX4" and "${merchant_fee_waive_value}" == "false"    Calculate Air Fees-SG Merchant Fee
    ...    ELSE    Set Test Variable    ${merchant_fee_amount}    0
    Calculate Air Fees-SG Total Selling Fare With Formula

Generate Test Variables For Air Fees-SG Without Formula
    Calculate Air Fees-SG Total Selling Fare Without Formula
    Calculate Air Fees-SG Nett Cost In EO Without Formula
    Set Test Variable    ${merchant_fee_amount}    ${merchant_fee_value}

Remove Decimal Places For Air Fees-HK
    ${commission_amount}    Remove String    ${commission_amount}    .00
    ${merchant_fee_amount}    Remove String    ${merchant_fee_amount}    .00
    ${total_selling_fare_amount}    Remove String    ${total_selling_fare_amount}    .00
    ${nett_cost_amount}    Remove String    ${nett_cost_amount}    .00
    ${selling_price_amount}    Remove String    ${selling_price_amount}    .00
    ${discount_amount}    Remove String    ${discount_amount}    .00
    ${nett_fare_amount}    Remove String    ${nett_fare_amount}    .00
    Set Test Variable    ${commission_amount}
    Set Test Variable    ${merchant_fee_amount}
    Set Test Variable    ${total_selling_fare_amount}
    Set Test Variable    ${nett_cost_amount}
    Set Test Variable    ${selling_price_amount}
    Set Test Variable    ${discount_amount}
    Set Test Variable    ${nett_fare_amount}
    
Send Other Service Fees For Air Fees IN Post Request
    [Arguments]    ${token}=${default_token}
    Create Session    fees    ${${env}_base_url}    verify=True
    ${headers}    Run Keyword If    "${token}" != "None"    Create Dictionary    Content-Type=application/json    Authorization=Bearer ${token}
    ...    ELSE    Create Dictionary    Content-Type=application/json
    ${other_service_fees_request_list_1}    Create List
    ${other_service_fees_request_list_2}    Create List
    ${other_service_fees_products_list}    Create List
    Run Keyword If    "${air_segment_count_value}"!="null"    Append To List    ${other_service_fees_request_list_1}    "airSegmentCount":${air_segment_count_value}
    Run Keyword If    "${airline_commission_value}"!="null"    Append To List    ${other_service_fees_request_list_1}    "airlineCommissionPercent":${airline_commission_value}
    Run Keyword If    "${airline_overhead_commission_by_percent_value}"!="null"    Append To List    ${other_service_fees_request_list_1}    "airlineOverheadCommissionByPercent":${airline_overhead_commission_by_percent_value} 
    Run Keyword If    "${airline_overhead_commission_percentage_value}"!="null"    Append To List    ${other_service_fees_request_list_1}    "airlineOverheadCommissionPercent":${airline_overhead_commission_percentage_value}
    Run Keyword If    "${airline_overhead_commission_value}"!="null"    Append To List    ${other_service_fees_request_list_1}    "airlineOverheadCommission":${airline_overhead_commission_value}
    Run Keyword If    "${base_fare_value}"!="null"    Append To List    ${other_service_fees_request_list_1}    "baseFare":${base_fare_value}
    Run Keyword If    "${city_code_value}"!="null"    Append To List    ${other_service_fees_request_list_1}    "cityCode":"${city_code_value}"
    Run Keyword If    "${client_account_number_value}"!="null"    Append To List    ${other_service_fees_request_list_1}    "clientAccountNumber":"${client_account_number_value}"
    Run Keyword If    "${commission_enabled_value}"!="null"    Append To List    ${other_service_fees_request_list_1}    "commissionEnabled":${commission_enabled_value}
    Run Keyword If    "${country}"!="null"    Append To List    ${other_service_fees_request_list_1}    "countryCode":"${country.upper()}"
    Run Keyword If    "${discount_enabled_value}"!="null"    Append To List    ${other_service_fees_request_list_1}    "discountEnabled":${discount_enabled_value}
    Run Keyword If    "${discount_percentage_value}"!="null"    Append To List    ${other_service_fees_request_list_1}    "discountPercent":${discount_percentage_value}
    Run Keyword If    "${fee_override_value}"!="null"    Append To List    ${other_service_fees_request_list_1}    "feeOverride":${fee_override_value}
    Run Keyword If    "${fee_override_value}"=="true"    Run Keyword If    "${transaction_fee_value}" !="null"    Append To List    ${other_service_fees_request_list_1}    "fee":${transaction_fee_value}
    Run Keyword If    "${gst_enabled_value}"!="null"    Append To List    ${other_service_fees_request_list_1}    "gstEnabled":${gst_enabled_value}
    Run Keyword If    "${markup_enabled_value}"!="null"    Append To List    ${other_service_fees_request_list_1}    "markupEnabled":${markup_enabled_value}
    Run Keyword If    "${merchant_fee_percentage_value}"!="null"    Append To List    ${other_service_fees_request_list_1}    "merchantFeePercent":${merchant_fee_percentage_value}
    Run Keyword If    "${overhead_commission_enabled_value}"!="null"    Append To List    ${other_service_fees_request_list_1}    "overheadCommissionEnabled":${overhead_commission_enabled_value}
    Run Keyword If    "${client_overhead_commission_percentage_value}"!="null"    Append To List    ${other_service_fees_request_list_1}    "clientOverheadCommissionPercent":${client_overhead_commission_percentage_value}
    Run Keyword If    "${plat_carrier_value}"!="null"    Append To List    ${other_service_fees_request_list_1}    "platCarrier":"${plat_carrier_value}"
    Run Keyword If    "${products_gst_percentage_value}"!="null"    Append To List    ${other_service_fees_products_list}    "gstPercent":${products_gst_percentage_value}
    Run Keyword If    "${products_ot1_percentage_value}"!="null"    Append To List    ${other_service_fees_products_list}    "ot1Percent":${products_ot1_percentage_value}
    Run Keyword If    "${products_ot2_percentage_value}"!="null"    Append To List    ${other_service_fees_products_list}    "ot2Percent":${products_ot2_percentage_value}
    Run Keyword If    "${products_override_pc_value}"!="null"    Append To List    ${other_service_fees_products_list}    "overridePc":${products_override_pc_value}
    Run Keyword If    "${tax_1_value}"!="null"    Append To List    ${other_service_fees_request_list_2}    "tax1":${tax_1_value}
    Run Keyword If    "${tax_2_value}"!="null"    Append To List    ${other_service_fees_request_list_2}    "tax2":${tax_2_value}
    Run Keyword If    "${trip_type_value}"!="null"    Append To List    ${other_service_fees_request_list_2}    "tripType":"${trip_type_value}"
    Run Keyword If    "${yq_tax_value}"!="null"    Append To List    ${other_service_fees_request_list_2}    "yqTax":${yq_tax_value}
    ${list_count_1}    Get Length    ${other_service_fees_request_list_1}
    : FOR    ${i}    IN RANGE    0    ${list_count_1}
    \    ${fees_list_1}    Set Variable If    ${i}==0    ${EMPTY}    ${fees_list_1},
    \    ${fees_list_1}    Set Variable    ${fees_list_1}${other_service_fees_request_list_1[${i}]}
    ${list_count_2}    Get Length    ${other_service_fees_products_list}
    : FOR    ${i}    IN RANGE    0    ${list_count_2}
    \    ${products_list}    Set Variable If    ${i}==0    ${EMPTY}    ${products_list},
    \    ${products_list}    Set Variable    ${products_list}${other_service_fees_products_list[${i}]}
        ${list_count_3}    Get Length    ${other_service_fees_request_list_2}
    : FOR    ${i}    IN RANGE    0    ${list_count_3}
    \    ${fees_list_2}    Set Variable If    ${i}==0    ${EMPTY}    ${fees_list_2},
    \    ${fees_list_2}    Set Variable    ${fees_list_2}${other_service_fees_request_list_2[${i}]}
    ${data}    Set Variable    {${fees_list_1},"product":{${products_list}},${fees_list_2}}
    Log    ${data}
    ${response}    Post Request    fees    /apac-services-rest/api/other-service-fees/air-fees/in    data=${data}    headers=${headers}
    Set Test Variable    ${response}
    Log    ${response.headers}
    Log    ${response.content}
    Set Test Variable    ${api_flag}    fees

Send Other Service Fees For Air Fees Post Request
    [Arguments]    ${token}=${default_token}
    Create Session    fees    ${${env}_base_url}    verify=True
    ${headers}    Run Keyword If    "${token}" != "None"    Create Dictionary    Content-Type=application/json    Authorization=Bearer ${token}
    ...    ELSE    Create Dictionary    Content-Type=application/json
    ${other_service_fees_request_list}    Create List
    Run Keyword If    "${cc_value}"!="null"    Append To List    ${other_service_fees_request_list}    "fopType":"${cc_value}"
    ${client_type}    Set Variable If    "${client_type_value}"=="NULL"    null    "${client_type_value}"=="None"    None    "${client_type_value}"
    Run Keyword If    "${client_type_value}"!="null"    Append To List    ${other_service_fees_request_list}    "clientType":${client_type}
    Run Keyword If    "${client_account_number_value}"!="null"    Append To List    ${other_service_fees_request_list}    "clientAccountNumber":"${client_account_number_value}"
    Run Keyword If    "${merchant_fee_absorb_value}"!="null"    Append To List    ${other_service_fees_request_list}    "merchantFeeAbsorb":${merchant_fee_absorb_value}
    Run Keyword If    "${merchant_fee_waive_value}"!="null"    Append To List    ${other_service_fees_request_list}    "merchantFeeWaive":${merchant_fee_waive_value}
    Run Keyword If    "${apply_formula_value}"!="null"    Append To List    ${other_service_fees_request_list}    "applyFormula":${apply_formula_value}
    Run Keyword If    "${merchant_fee_value}"!="null"    Append To List    ${other_service_fees_request_list}    "merchantFee":${merchant_fee_value}
    Run Keyword If    "${commission_value}"!="null"    Append To List    ${other_service_fees_request_list}    "commission":${commission_value}
    Run Keyword If    "${commission_percent_flag_value}"!="null"    Append To List    ${other_service_fees_request_list}    "commissionByPercent":${commission_percent_flag_value}
    Run Keyword If    "${commission_percentage_value}"!="null"    Append To List    ${other_service_fees_request_list}    "commissionPercent":${commission_percentage_value}
    Run Keyword If    "${cwt_absorb_value}"!="null"    Append To List    ${other_service_fees_request_list}    "cwtAbsorb":${cwt_absorb_value}
    Run Keyword If    "${discount_value}"!="null"    Append To List    ${other_service_fees_request_list}    "discount":${discount_value}
    Run Keyword If    "${discount_percent_flag_value}"!="null"    Append To List    ${other_service_fees_request_list}    "discountByPercent":${discount_percent_flag_value}
    Run Keyword If    "${discount_percentage_value}"!="null"    Append To List    ${other_service_fees_request_list}    "discountPercent":${discount_percentage_value}
    Run Keyword If    "${nett_fare_value}"!="null"    Append To List    ${other_service_fees_request_list}    "nettFare":${nett_fare_value}
    ${product_type}    Set Variable If    "${product_type_value}"=="NULL"    null    "${product_type_value}"=="None"    None    "${product_type_value}"
    Run Keyword If    "${product_type_value}"!="null"    Append To List    ${other_service_fees_request_list}    "productType":${product_type}
    Run Keyword If    "${tax_1_value}"!="null"    Append To List    ${other_service_fees_request_list}    "tax1":${tax_1_value}
    Run Keyword If    "${tax_2_value}"!="null"    Append To List    ${other_service_fees_request_list}    "tax2":${tax_2_value}
    Run Keyword If    "${web_fare_flag_value}"!="null"    Append To List    ${other_service_fees_request_list}    "webFareSelected":${web_fare_flag_value}
    ${selling_price_exists}    Run Keyword If    "${country}"=="sg"    Run Keyword And Return Status    Variable Should Exist    ${selling_price_value}
    ...    ELSE    Set Variable    False
    Run Keyword If    "${selling_price_exists}"=="True"    Append To List    ${other_service_fees_request_list}    "sellingPrice":${selling_price_value}
    ${transaction_fee_exists}    Run Keyword And Return Status    Variable Should Exist    ${transaction_fee_value}
    Run Keyword If    "${transaction_fee_exists}"=="True"    Append To List    ${other_service_fees_request_list}    "transactionFee":${transaction_fee_value}
    ${uatp_exists}    Run Keyword And Return Status    Variable Should Exist    ${uatp_flag_value}
    Run Keyword If    "${uatp_exists}"=="True"    Append To List    ${other_service_fees_request_list}    "uatp":${uatp_flag_value}
    ${list_count}    Get Length    ${other_service_fees_request_list}
    : FOR    ${i}    IN RANGE    0    ${list_count}
    \    ${fees_list}    Set Variable If    ${i}==0    ${EMPTY}    ${fees_list},
    \    ${fees_list}    Set Variable    ${fees_list}${other_service_fees_request_list[${i}]}
    ${data}    Set Variable    {${fees_list}}
    Log    ${data}
    ${response}    Post Request    fees    /apac-services-rest/api/other-service-fees/air-fees/${country}    data=${data}    headers=${headers}
    Set Test Variable    ${response}
    Log    ${response.headers}
    Log    ${response.content}
    Set Test Variable    ${api_flag}    fees

Verify Calculated Air Fees Are Not Returned Correctly
    Verify String Does Not Contain Substring    ${response.text}    "commission"
    Verify String Does Not Contain Substring    ${response.text}    "totalSellingFare"
    Verify String Does Not Contain Substring    ${response.text}    "nettCost"
    Verify String Does Not Contain Substring    ${response.text}    "sellingPrice"
    Verify String Does Not Contain Substring    ${response.text}    "merchantFee"
    Verify String Does Not Contain Substring    ${response.text}    "discount"
    Verify String Does Not Contain Substring    ${response.text}    "nettFare"
    
Verify Calculated Air Fees India Are Not Returned Correctly
    Verify String Does Not Contain Substring    ${response.text}    "totalAirlineCommission"
    Verify String Does Not Contain Substring    ${response.text}    "totalCharge"
    Verify String Does Not Contain Substring    ${response.text}    "totalGst"
    Verify String Does Not Contain Substring    ${response.text}    "totalSellFare"
    Verify String Does Not Contain Substring    ${response.text}    "totalSellingFare"
    Verify String Does Not Contain Substring    ${response.text}    "totalTaxes"
    Verify String Does Not Contain Substring    ${response.text}    "totalMerchantFee"

Verify Calculated Air Fees Are Returned Correctly
    ${data}    Remove String    ${response.text}    {
    ${data}    Remove String    ${data}    }
    ${data}    Remove String    ${data}    "
    ${data_list}    Split String    ${data}    ,
    : FOR    ${item}    IN    @{data_list}
    \    ${items}    Split String    ${item}    :
    \    Verify Actual Numerical Value Matches Expected Numerical Value    ${items[1]}    ${${items[0]}_amount}

Verify Response Contains Calculated Fee
    [Arguments]    ${element}
    Verify String Contains Substring    ${response.text}    "${element}"
    
Verify Response Does Not Contain Calculated Fee
    [Arguments]    ${element}
    Verify String Does Not Contain Substring    ${response.text}    "${element}"