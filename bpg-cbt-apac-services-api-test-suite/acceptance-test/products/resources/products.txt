*** Keywords ***
Create New List
    [Arguments]    ${product_number}
    @{product_list}    Create List
    Set Test Variable    ${product_code_${product_number}_list}    ${product_list}
    Append To List    ${all_product_list}    ${product_number}
    Set Test Variable    ${all_product_list}

Create Test Variables For Products And Vendors
    [Arguments]    ${country}
    @{all_product_list}    Create List
    Set Test Variable    ${all_product_list}
    ${data_list_1}    Split String    ${${country}_data_list_1}    |
    : FOR    ${data}    IN    @{data_list_1}
    \    ${data_item}    Split String    ${data}    ,
    \    ${data_type}    Get Substring    ${data_item[0]}    0    3
    \    ${item_number}    Get Substring    ${data_item[0]}    3
    \    ${data_type}    Set Variable If    "${data_type.upper()}"=="PRO"    product    vendor
    \    Run Keyword If    "${data_type}"=="product"    Create New List    ${item_number}
    \    Set Test Variable    ${${data_type}_code_${item_number}}    ${data_item[1]}
    ${data_list_2}    Split String    ${${country}_data_list_2}    |
    : FOR    ${data}    IN    @{data_list_2}
    \    ${data_item}    Split String    ${data}    ,
    \    ${product_number}    Get Substring    ${data_item[0]}    3
    \    ${vendor_number}    Get Substring    ${data_item[1]}    3
    \    Append To List    ${product_code_${product_number}_list}    ${vendor_number}
    : FOR    ${item}    IN    @{all_product_list}
    \    Set Test Variable    ${product_code_${product_number}_list}
    \    Log    ${product_code_${item}_list}
    Set Test Variable    ${country}    ${country.upper()}
    Set Test Variable    ${all_product_list}

Send Product Get Request
    [Arguments]    ${token}=${default_token}
    Create Session    product    ${${env}_base_url}    verify=True
    ${headers}    Run Keyword If    "${token}" != "None"    Create Dictionary    Content-Type=application/json    Authorization=Bearer ${token}
    ...    ELSE    Create Dictionary    Content-Type=application/json
    ${response}    Get Request    product    /bpg-cbt-apac-services-rest/api/products?countryCode=${country}    headers=${headers}
    Set Test Variable    ${response}
    Log    ${response.headers}
    Log    ${response.content}
    Set Test Variable    ${api_flag}    products

Verify Products And Vendors Are Not Retrieved
    Verify String Does Not Contain Substring    ${response.content}    "vendors"
    Verify String Does Not Contain Substring    ${response.content}    "countryCode"
    Verify String Does Not Contain Substring    ${response.content}    "productCode"
    Verify String Does Not Contain Substring    ${response.content}    "description"
    Verify String Does Not Contain Substring    ${response.content}    "enableCCFOP"
    Verify String Does Not Contain Substring    ${response.content}    "gst"
    Verify String Does Not Contain Substring    ${response.content}    "mi"
    Verify String Does Not Contain Substring    ${response.content}    "sortKey"
    Verify String Does Not Contain Substring    ${response.content}    "tktNo"
    Verify String Does Not Contain Substring    ${response.content}    "tktPrefix"
    Verify String Does Not Contain Substring    ${response.content}    "type"

Verify Products And Vendors Are Retrieved Correctly
    ${all_product_list_length}    Get Length    ${all_product_list}
    : FOR    ${index}    IN RANGE    ${all_product_list_length}
    \    ${item_product_code}    Get Json Value    ${response.content}    /${index}/productCode
    \    ${item_product_code}    Get Substring    ${item_product_code}    1    -1
    \    Verify Json Value Is Correct    /${index}/description    ${product_code_${item_product_code}}
    \    Verify Vendors Are Retrieved Correctly    ${index}    ${product_code_${item_product_code}_list}
    ${index}    Evaluate    ${index}+1
    Verify Json Element Does Not Exist    /${index}/description

Verify Vendors Are Retrieved Correctly
    [Arguments]    ${index}    ${item_vendor_list}
    ${item_vendor_list_length}    Get Length    ${item_vendor_list}
    ${vendor_index}    Set Variable    0
    : FOR    ${vendor_index}    IN RANGE    ${item_vendor_list_length}
    \    ${item_vendor_number}    Get Json Value    ${response.content}    /${index}/vendors/${vendor_index}/vendorNumber
    \    ${item_vendor_number}    Get Substring    ${item_vendor_number}    1    -1
    \    Should Contain X Times    ${item_vendor_list}    ${item_vendor_number}    1
    \    Verify Json Value Is Correct    /${index}/vendors/${vendor_index}/vendorName    ${vendor_code_${item_vendor_number}}
    ${vendor_index}    Evaluate    ${vendor_index}+1
    Verify Json Element Does Not Exist    /${index}/vendors/${vendor_index}/vendorName
